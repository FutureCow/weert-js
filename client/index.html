<!DOCTYPE html>
<html lang='en'>
<head>
    <title>Welcome to WeeRT</title>
    <link rel='stylesheet' type='text/css' href='../css/weewx.css'/>
    <link rel='stylesheet' type='text/css' href='../css/weert.css'/>
    <meta content='en-us' http-equiv='Content-Language'/>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'/>

    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.10/handlebars.min.js'></script>
    <script src='dist/plotly-basic.min.js'></script>
    <script src='dist/faye-browser.js' type='text/javascript'></script>
    <script src='js/weert.js' type='text/javascript'></script>
    <script src='js/datamgr.js' type='text/javascript'></script>
    <script src='js/plots.js' type='text/javascript'></script>
    <script src='js/WindCompass.js' type='text/javascript'></script>
    <script src='js/rt.js' type='text/javascript'></script>
</head>
<body onload='initTabs();'>


<script id='wx-console-template' type='text/x-handlebars-template'>
    <div class='stats'>
        <div class='stats_header'>
            Current Conditions
        </div>

        <table>
            <tbody>
            <tr>
                <td class='stats_label'>Time</td>
                <td class='stats_data fadeIn'>{{formatTimeStamp timestamp}}</td>
            </tr>
            <tr>
                <td class='stats_label'>Outside Temperature</td>
                <td class='stats_data'>{{precision fields.outside_temperature 3}}</td>
            </tr>
            <tr>
                <td class='stats_label'>Inside Temperature</td>
                <td class='stats_data'>{{precision fields.inside_temperature 3}}</td>
            </tr>
            <tr>
                <td class='stats_label'>Humidity</td>
                <td class='stats_data'>{{precision fields.outside_humidity 2}}</td>
            </tr>
            <tr>
                <td class='stats_label'>Barometer</td>
                <td class='stats_data'>{{precision fields.sealevel_pressure 5}}</td>
            </tr>
            <tr>
                <td class='stats_label'>Wind</td>
                <td class='stats_data'>{{fixed fields.wind_speed 0}} from {{fixed fields.wind_dir
                                       0}}
                </td>
            </tr>
            <tr>
                <td class='stats_label'>UV</td>
                <td class='stats_data'>{{fixed fields.uv_uv 0}}</td>
            </tr>
            <tr>
                <td class='stats_label'>Solar Radiation</td>
                <td class='stats_data'>{{precision fields.radiation_radiation 3}}</td>
            </tr>
            </tbody>
        </table>
    </div> <!-- End class "stats" -->
</script>


<script id='wx-stats-template' type='text/x-handlebars-template'>
    <div class='stats'>
        <div class='stats_header'>
            Since Midnight
        </div>
        <table>
            <tbody>
            <tr>
                <td class='stats_label'>
                    High Temperature<br/>
                    Low Temperature
                </td>
                <td class='stats_data'>
                    {{precision day.outside_temperature.max.value 3}} at {{formatTimeStamp
                    day.outside_temperature.max.time}}<br/>
                    {{precision day.outside_temperature.min.value 3}} at {{formatTimeStamp
                    day.outside_temperature.min.time}}
                </td>
            </tr>
            <tr>
                <td class='stats_label'>
                    High Heat Index<br/>
                    Low Wind Chill
                </td>
                <td class='stats_data'>
                    {{precision day.heatindex_temperature.max.value 3}} at {{formatTimeStamp
                    day.heatindex.max.time}}<br/>
                    {{precision day.windchill_temperature.min.value 3}} at {{formatTimeStamp day.windchill.min.time}}
                </td>
            </tr>
            <tr>
                <td class='stats_label'>
                    High Humidity<br/>
                    Low Humidity
                </td>
                <td class='stats_data'>
                    {{precision day.outside_humidity.max.value 3}} at {{formatTimeStamp day.outHumidity.max.time}}<br/>
                    {{precision day.outside_humidity.min.value 3}} at {{formatTimeStamp day.outHumidity.min.time}}
                </td>
            </tr>
            <tr>
                <td class='stats_label'>
                    High Dewpoint<br/>
                    Low Dewpoint
                </td>
                <td class='stats_data'>
                    {{precision day.dewpoint_temperature.max.value 3}} at {{formatTimeStamp day.dewpoint.max.time}}<br/>
                    {{precision day.dewpoint_temperature.min.value 3}} at {{formatTimeStamp day.dewpoint.min.time}}
                </td>
            </tr>
            <tr>
                <td class='stats_label'>
                    High Barometer<br/>
                    Low Barometer
                </td>
                <td class='stats_data'>
                    {{precision day.sealevel_pressure.max.value 3}} at {{formatTimeStamp day.barometer.max.time}}<br/>
                    {{precision day.sealevel_pressure.min.value 3}} at {{formatTimeStamp day.barometer.min.time}}
                </td>
            </tr>
            <tr>
                <td class='stats_label'>Today's Rain</td>
                <td class='stats_data'>{{precision day.rain_rain.sum.value 3}}</td>
            </tr>
            <tr>
                <td class='stats_label'>
                    High Wind
                </td>
                <td class='stats_data'>
                    {{precision day.wind_speed.max.value 3}} at {{formatTimeStamp day.wind_speed.max.time}}
                </td>
            </tr>
            <tr>
                <td class='stats_label'>
                    Average Wind
                </td>
                <td class='stats_data'>
                    {{precision day.wind_speed.avg.value 3}}
                </td>
            </tr>
            <tr>
                <td class='stats_label'>
                    High Radiation<br/>
                    Low Radiation
                </td>
                <td class='stats_data'>
                    {{precision day.radiation.max.value 3}} at {{formatTimeStamp day.radiation.max.time}}<br/>
                    {{precision day.radiation.min.value 3}} at {{formatTimeStamp day.radiation.min.time}}
                </td>
            </tr>
            </tbody>
        </table>
    </div> <!--End class "stats" -->
</script>

<div id='container'>

    <h1>Welcome to WeeRT</h1>
    <h3>Real time weather updates</h3>

    <!-- Left hand side div -->
    <div id='stats_group'>
        <div id='wx-console-area'><!-- Current conditions will go here --></div>
        <div id='windCompass' class='compass'><!-- Animated wind compass will go here --></div>
    </div>

    <!-- Right-hand side div -->
    <div id='content'>
        <ul id='tabs'>
            <li><a href='#recent'>Recent</a></li>
            <li><a href='#day'>24 Hours</a></li>
        </ul>
        <div id='recent' class='plot-group'>Minutes:
            <label><input type='radio' name='recent_span' value='5' onchange='changeSpan(this);' checked>5</label>
            <label><input type='radio' name='recent_span' value='10' onchange='changeSpan(this);'>10</label>
            <label><input type='radio' name='recent_span' value='20' onchange='changeSpan(this);'>20</label>
            <label><input type='radio' name='recent_span' value='60' onchange='changeSpan(this);'>60</label>

            <div id='recent-windspeed-div' class='plot-area'></div>
            <div id='recent-outtemp-div' class='plot-area'></div>
            <div id='recent-radiation-div' class='plot-area'></div>
        </div>    <!-- End id "recent" -->
        <div id='day' class='plot-group'>
            <div id='day-windspeed-div' class='plot-area'></div>
            <div id='day-outtemp-div' class='plot-area'></div>
            <div id='day-radiation-div' class='plot-area'></div>
        </div>    <!-- End id "day" -->
    </div>     <!-- End id "content" -->

    <h2>Architecture</h2>
    <ul>
        <li>Uses a <a href='https://nodejs.org'>Node</a> server with the
            <a href='http://expressjs.com'>Express framework</a>;
        </li>
        <li>The server receives packet updates from WeeWX via a RESTful interface;</li>
        <li>The packets are stored in an <a href='https://www.influxdata.com'>InfluxDB</a> server;</li>
        <li>The browser requests the data via a RESTful interface from the Node server;</li>
        <li>Real time updates are done through a publish - subscribe interface
            using <a href='http://faye.jcoglan.com'>Faye;</a></li>
        <li>Real time plots are done using the plotting library
            <a href='https://plot.ly/javascript'>Plotly.js</a>.
        </li>
    </ul>

    <p>Source code and README can be found in the
        <a href='https://github.com/tkeffer/weert-js'>GitHub repository</a></p>

</div>         <!-- End id "container" -->
</body>
</html>